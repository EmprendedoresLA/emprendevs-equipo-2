<!DOCTYPE HTML>
<html>
  <head>
    <script src="https://localhost:8080/jquery-1.11.3.min.js"></script>
    <link rel="stylesheet" media="all" href="https://localhost:8080/global.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta charset="utf-8">
    <title>Easyparking</title>
  </head>
  <body>
    <div id="deshabilitar" style="display:none">
      <div><img src="https://localhost:8080/loading.gif" alt="" title="Cargando..."> Cargando...</div>
    </div>
    <div class="form login index" id="login">
      <div class="mensaje error" id="errlogin" style="display:none">Tel&eacute;fono o clave incorrectos</div>
      <p>
        <label for="username">Tel&eacute;fono</label>
        <input type="text" name="username" id="username" placeholder="341606060">
      </p>
      <p>
        <label for="password">Clave</label>
        <input type="password" name="password" id="password" placeholder="****">
      </p>
      <p class="completar">
        <input type="button" id="btlogin" class="login submit" value="Acceder">
        <ul class="enlaces">
          <li><a href="http://moviltr.com.ar/" target="_blank">Obtener una clave</a></li>
          <li><a href="http://moviltr.com.ar/" target="_blank">Obtener informaci&oacute;n</a></li>
        </ul>
      </p>
    </div>
    <div class="index parking" id="main">
      <div id="nuevo" class="form" style="display:none">
        <p>
          <label for="direccion">Direcci&oacute;n</label>
          <input type="text" name="calle" placeholder="Calle">
          <input type="text" name="numero" placeholder="0000" style="margin-top:5px">
        </p>
        <p class="completar">
          <input type="button" id="btpagar" value="Pagar">
        </p>
      </div>
      <div id="actual" class="form" style="display:none">
        <p>
          <label for="direccion">Direcci&oacute;n actual</label>
          <input type="text" id="direccion" name="direccion" value="">
        </p>
        <p>
          <label for="fdesde">Desde</label>
          <input type="text" id="fdesde" name="fdesde" value="">
        </p>
        <p>
          <label for="fhasta">Hasta</label>
          <input type="text" id="fhasta" name="fhasta" value="">
        </p>
      </div>
    </div>
    <script>
    (function(){
      // Boton de login
      $('#btlogin').click(function(){
        if ($('#username').val().trim() == '' || $('#password').val().trim() == '')
        {
          $('#errlogin').fadeIn('fast').delay(5000).fadeOut('slow');
          return;
        }

        $('#deshabilitar').fadeIn(500, function(){
          $.ajax({
            url: "https://localhost:8080/user/login",
            type: "GET",
            dataType: "json",
            success:function()
            {
              $('#deshabilitar').fadeOut('fast', function()
              {
                $.ajax({
                  url: "https://localhost:8080/parking",
                  type: "GET",
                  dataType: "json",
                  data:{
                    'user':$('#username').val(),
                    'password':$('#password').val()
                  },
                  success:function(respuesta)
                  {
                    if (typeof respuesta.current_parking != 'undefined')
                    {
                      // Mostrar informacion del estacionamiento actual
                      $('#direccion').val(respuesta.current_parking.streetName + ' ' + respuesta.current_parking.streetNumber);

                      $('#deshabilitar, #login').fadeOut('fast', function(){
                        $('#main, #actual').fadeIn('fast');
                      })
                    }
                    else
                    {
                      // No hay parking actual
                      $('#deshabilitar, #login').fadeOut('fast', function(){
                        $('#main, #nuevo').fadeIn('fast');
                      })
                    }
                  },
                  error:function(xhr, optiones, thrownerr)
                  {
                    // Ocurrio un error
                  }
                });
              });
            },
            error:function(xhr, options, thrownerr)
            {
              if (xhr.status == 403)
              {
                // Datos incorrectos
                $('#deshabilitar').fadeOut('fast', function(){
                  $('#errlogin').fadeIn('fast');
                })
              }
              else
              {
                  // Ocurrio otro error
              }
            }
          });
        });
      });

      // Pagar estacionamiento
    })();
    </script>
  </body>
</html>
